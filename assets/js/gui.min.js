"use strict";window.gui=function(){let e={notifyError:function(t){e._console_error(t);const n=t.message||t.reason.message||t;notie.alert({type:"error",text:"Erreur : "+n,stay:!1,time:3,position:"top"});try{Basthon.Goodies.hideLoader()}catch{}},init:async function(){const t=e.notifyError;window.addEventListener("error",t),window.addEventListener("unhandledrejection",t),e._console_error=console.error,console.error=function(){t({message:String(arguments[0])})},e.initStateFromStorage("switched",!1),e.initStateFromStorage("darkmode",!0),e.updateSwitchView(),e.updateDarkLight();let n=document.getElementById("run");n.addEventListener("click",e.runScript),(n=document.getElementById("open")).addEventListener("click",e.openFile),(n=document.getElementById("download")).addEventListener("click",e.download),(n=document.getElementById("share")).addEventListener("click",e.share),(n=document.getElementById("raz")).addEventListener("click",e.restart),(n=document.getElementById("btn_shell")).addEventListener("click",e.showShell),(n=document.getElementById("btn_graph_view")).addEventListener("click",e.showGraph),(n=document.getElementById("darklight")).addEventListener("click",e.switchDarkLight),(n=document.getElementById("switch")).addEventListener("click",e.switchView),(n=document.getElementById("hide-console")).addEventListener("click",e.hideConsole),(n=document.getElementById("hide-editor")).addEventListener("click",e.hideEditor),(n=document.getElementById("show-editor-console")).addEventListener("click",e.showEditorConsole),await e.basthonInit()},initCaller:async function(t,n){Basthon.Goodies.setLoaderText(n);try{return await t()}catch(t){e.notifyError(t)}},basthonInit:async function(){await Basthon.Goodies.showLoader("Chargement de Basthon...",!1);const t=e.initCaller;await t(shell.init,"Chargement de la console..."),await t(editor.init,"Chargement de l'éditeur..."),await t(e.loadURLAux,"Chargement des fichiers auxiliaires..."),await t(e.loadURLModules,"Chargement des modules annexes..."),Basthon.Goodies.hideLoader(),window.onbeforeunload=function(){editor.backup().catch(e.notifyError)},Basthon.addEventListener("eval.finished",function(e){e.interactive&&"result"in e&&shell.append(e.result["text/plain"]+"\n"),shell.newline()}),Basthon.addEventListener("eval.output",function(e){shell.append(e.content)}),Basthon.addEventListener("eval.error",function(e){shell.newline()}),Basthon.addEventListener("eval.display",function(e){graphics.display(e)})},_loadFromURL:async function(e,t){const n=new URL(window.location.href);let o=[];for(let i of n.searchParams.getAll(e)){const e=(i=decodeURIComponent(i)).split("/").pop();let n=Basthon.xhr({method:"GET",url:i,responseType:"arraybuffer"});n=n.then(function(n){return t(e,n)}).catch(function(){throw{message:"Impossible de charger le fichier "+e+".",name:"LoadingException"}}),o.push(n)}await Promise.all(o)},loadURLAux:function(){return e._loadFromURL("aux",Basthon.putFile)},loadURLModules:function(){return e._loadFromURL("module",Basthon.putModule)},initStateFromStorage:function(t,n=!1){"undefined"!=typeof Storage&&null!==localStorage.getItem(t)?e[t]="true"===localStorage.getItem(t):e[t]=n},saveStateInStorage:function(t){"undefined"!=typeof Storage&&localStorage.setItem(t,e[t])},runScript:function(){editor.backup().catch(e.notifyError);const t=editor.getValue();shell.append(t.split("\n").join("\n... ")+"\n"),shell.launch(t,!1),shell.focus(),shell.cursorToEnd()},restart:function(){Basthon.restart(),shell.init(),graphics.clean()},putFSRessource:function(e){return new Promise(function(t,n){const o=new FileReader;o.readAsArrayBuffer(e),o.onload=async function(n){await Basthon.putRessource(e.name,n.target.result),notie.alert({type:"success",text:e.name+" est maintenant utilisable depuis Python",stay:!1,time:3,position:"top"}),t()},o.onerror=n})},openEditor:async function(e){await editor.open(e),notie.alert({type:"success",text:e.name+" est chargé dans l'éditeur",stay:!1,time:3,position:"top"})},openPythonFile:async function(t){notie.confirm({text:"Que faire de "+t.name+" ?",submitText:"Charger dans l'éditeur",cancelText:"Installer le module",position:"top",submitCallback:()=>{e.openEditor(t)},cancelCallback:()=>{e.putFSRessource(t)}})},openFile:function(){return new Promise(function(t,n){let o=document.createElement("input");o.type="file",o.style.display="none",o.onchange=async function(n){for(let t of n.target.files){"py"===t.name.split(".").pop()?await e.openPythonFile(t):await e.putFSRessource(t)}t()},o.onerror=n,document.body.appendChild(o),o.click(),document.body.removeChild(o)})},download:function(){editor.download("script.py")},hideConsole:function(){let e=document.getElementById("hide-console");e.style.display="none",(e=document.getElementById("hide-editor")).style.display="";let t=document.getElementById("right-div");t.style.display="none",(t=document.getElementById("left-div")).style.display="",t.style.width="100%"},hideEditor:function(){let e=document.getElementById("hide-editor");e.style.display="none",(e=document.getElementById("show-editor-console")).style.display="";let t=document.getElementById("left-div");t.style.display="none",(t=document.getElementById("right-div")).style.display="",t.style.width="100%"},showEditorConsole:function(){let e=document.getElementById("show-editor-console");e.style.display="none",(e=document.getElementById("hide-console")).style.display="";let t=document.getElementById("left-div");t.style.display="",t.style.width="50%",(t=document.getElementById("right-div")).style.display="",t.style.width="48%"},updateSwitchView:function(){let t=document.getElementById("left-div"),n=document.getElementById("right-div");e.switched?(t.style.cssFloat="right",n.style.cssFloat="left"):(t.style.cssFloat="left",n.style.cssFloat="right")},switchView:function(){e.switched=!e.switched,e.updateSwitchView(),e.saveStateInStorage("switched")},updateDarkLight:function(){const t=document.getElementsByClassName("darklighted"),n=e.darkmode?"remove":"add";for(const e of t)e.classList[n]("light");const o=e.darkmode?"monokai":"xcode";editor.setTheme(`ace/theme/${o}`)},switchDarkLight:function(){e.darkmode=!e.darkmode,e.saveStateInStorage("darkmode"),e.updateDarkLight()},theme:function(){return e.darkmode?"dark":"light"},showShell:function(){shell.style.display="block",graphics.style.display="none",shell.cursorToEnd()},showGraph:function(){shell.style.display="none",graphics.style.display="flex"},share:function(){const t=editor.sharingURL();notie.confirm({text:document.getElementById("share_message").innerHTML,submitText:"Copier dans le presse-papier",cancelText:"Tester le lien",position:"top",submitCallback:function(){e.copyToClipboard(t)},cancelCallback:function(){let e=document.createElement("a");e.href=t,e.target="_blank",e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}})},copyToClipboard:function(e){let t=document.createElement("textarea");t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.width="2em",t.style.height="2em",t.style.padding=0,t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",t.value=e,document.body.appendChild(t),t.focus(),t.select();try{let e=document.execCommand("copy")?"successful":"unsuccessful";console.log("Copying text command was "+e)}catch(e){console.log("Oops, unable to copy")}document.body.removeChild(t)}};return e}(),window.gui.init();
//# sourceMappingURL=gui.min.js.map