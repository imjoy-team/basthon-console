"use strict";var Basthon=function(){let e={_pyodideUrl:"https://cdn.jsdelivr.net/pyodide/v0.15.0/full/pyodide.js",dirname:function(e){return e.substring(0,e.lastIndexOf("/"))},loaded:!1};return e.urlScript=document.currentScript.src,e.basthonRoot=e.dirname(e.urlScript),e.packages=function(){let n={pyodide:null};return n.internal={turtle:{path:e.basthonRoot+"/turtle-0.0.1-py3-none-any.whl"},requests:{path:e.basthonRoot+"/requests-0.0.1-py3-none-any.whl"},proj4py:{path:e.basthonRoot+"/proj4py-0.0.1-py3-none-any.whl",deps:["pkg_resources"]},folium:{path:"folium"},graphviz:{path:e.basthonRoot+"/graphviz-0.0.1-py3-none-any.whl",deps:["pkg_resources"]},IPython:{path:e.basthonRoot+"/IPython-0.0.1-py3-none-any.whl"},p5:{path:e.basthonRoot+"/p5-0.0.1-py3-none-any.whl",deps:["pkg_resources"]}},n.all=null,n.loaded=null,n.init=function(){n.pyodide=new Set(Object.keys(pyodide._module.packages.import_name_to_package_name)),n.all=new Set([...n.pyodide,...Object.keys(n.internal)]),n.loaded=new Set},n._processPackagesBeforeLoad=function(e){return"string"==typeof e&&(e=[e]),(e=e.filter(e=>!n.loaded.has(e))).forEach(e=>n.loaded.add(e)),e},n.loadPyodide=async function(e,o){if(0===(e=n._processPackagesBeforeLoad(e)).length)return;const t=e.map(e=>pyodide._module.packages.import_name_to_package_name[e]);await pyodide.loadPackage(t),o&&o(e)},n.loadInternal=async function(e,o){if(0===(e=n._processPackagesBeforeLoad(e)).length)return;const t=e.map(e=>n.internal[e].path);await n.loadPyodide("micropip"),await pyodide.globals.Basthon.micropip_install(t),o&&o(e)},n.load=async function(e,o){if("string"==typeof e&&(e=[e]),0===e.length)return;const t=e.filter(e=>n.pyodide.has(e)),a=e.filter(e=>e in n.internal);await n.loadPyodide(t,o),await n.loadInternal(a,o)},n}(),e.download=function(e,n){let o=new Blob([e],{type:"application/octet-stream"}),t=document.createElement("a");t.download=n,t.href=window.URL.createObjectURL(o),t.target="_blank",t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)},e.loadScript=function(e){return new Promise(function(n,o){let t=document.createElement("script");t.onload=n,t.onerror=o,t.src=e,document.head.appendChild(t)})},e.pageLoad=new Promise(function(e,n){"complete"===document.readyState?e():window.addEventListener("load",function(){window.removeEventListener("load",this),e()})}),e._onload=function(){e.loaded=!0,e.addEventListener("eval.request",e.evalFromEvent);const n=pyodide.pyimport("sys");return e.pythonVersion=n.version,e.packages.init(),pyodide.runPythonAsync(`import pyodide ; pyodide.eval_code(pyodide.open_url('${e.basthonRoot}/basthon.py.js').getvalue(), globals())`)},e.xhr=function(e){const n=new XMLHttpRequest;n.open(e.method,e.url,!0),n.responseType=e.responseType;const o=new Promise(function(e,o){n.onload=function(){n.status>=200&&n.status<300?e(n.response):o(n)},n.onerror=function(){o(n)}});e.headers&&Object.keys(e.headers).forEach(function(o){n.setRequestHeader(o,e.headers[o])});let t=e.data;return t&&"object"==typeof t&&(t=JSON.stringify(t)),n.send(t),o},e.load=async function(){try{const n=e.basthonRoot+"/pyodide/pyodide.js";await e.xhr({method:"HEAD",url:n}),e._pyodideUrl=n}catch{}window.languagePluginUrl=e._pyodideUrl.substr(0,e._pyodideUrl.lastIndexOf("/"))+"/";try{"undefined"!=typeof requirejs?(requirejs.config({paths:{pyodide:e._pyodideUrl.slice(0,-3)}}),await new Promise(function(e,n){require(["pyodide"],e,n)})):await e.loadScript(e._pyodideUrl)}catch(e){console.log(e),console.error("Can't load pyodide.js")}await languagePluginLoader.then(e._onload,function(){console.error("Can't load Python from Pyodide")}),await e.pageLoad}(),e.dispatchEvent=function(e,n){const o=new CustomEvent("basthon."+e,{detail:n});document.dispatchEvent(o)},e.addEventListener=function(e,n){document.addEventListener("basthon."+e,function(e){n(e.detail)})},e.findImports=function(n){if(!e.loaded)return;let o=pyodide.globals.Basthon.find_imports(n);for(const n of o)o=o.concat((e.packages.internal[n]||{deps:[]}).deps);return o},e.clone=function(e){return JSON.parse(JSON.stringify(e))},e.eval=function(n,o=null){if(e.loaded)return pyodide.globals.Basthon.eval(n,o)},e.loadDependencies=async function(n,o){const t=e.findImports(n);return await e.packages.load(t,o)},e.hackPackagesCallback=function(e){e.includes("matplotlib")?pyodide.globals.Basthon.hack_matplotlib():e.includes("turtle")?pyodide.globals.Basthon.hack_turtle():e.includes("sympy")?pyodide.globals.Basthon.hack_sympy():e.includes("folium")?pyodide.globals.Basthon.hack_folium():e.includes("pandas")&&pyodide.globals.Basthon.hack_pandas()},e.loadDependenciesEvent=async function(n){return e.loadDependencies(n,e.hackPackagesCallback)},e.evalAsync=async function(n,o,t,a,d=null){if(e.loaded)return void 0===o&&(o=function(e){console.log(e)}),void 0===t&&(t=function(e){console.error(e)}),await e.loadDependencies(n,e.hackPackagesCallback),await pyodide.globals.Basthon.shell_eval(n,o,t,d)},e.evalFromEvent=function(n){if(!e.loaded)return;let o=function(o){return function(t){let a=e.clone(n);a.stream=o,a.content=t,e.dispatchEvent("eval.output",a)}},t=o("stdout"),a=o("stderr");return e.evalAsync(n.code,t,a,e.hackPackagesCallback,n).then(function(o){let t=e.clone(n);t.execution_count=e.executionCount(),void 0!==o&&(t.result=o),e.dispatchEvent("eval.finished",t)},function(o){a(o.toString());let t=e.clone(n);t.error=o,t.execution_count=e.executionCount(),e.dispatchEvent("eval.error",t)})},e.executionCount=function(){return pyodide.globals.Basthon.execution_count},e.restart=function(){if(e.loaded)return pyodide.globals.Basthon.restart()},e.putFile=function(e,n){pyodide.globals.Basthon.put_file(e,n)},e.putModule=async function(n,o){await e.loadDependencies(o,e.hackPackagesCallback),pyodide.globals.Basthon.put_module(n,o)},e.putRessource=function(n,o){return"py"===n.split(".").pop()?e.putModule(n,o):e.putFile(n,o)},e}();
//# sourceMappingURL=basthon.min.js.map